<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test Bavardage360</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #chat, #waiting { display: none; }
    #messages { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: scroll; }
    #waitingList { color: orange; }
  </style>
</head>
<body>
  <div id="join">
    <h2>Bavardage360 - Rejoindre</h2>
    <input type="text" id="username" placeholder="Entrez votre pseudo">
    <button onclick="joinChat()">Rejoindre</button>
  </div>
  <div id="chat">
    <h2>Salon de discussion</h2>
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="Tapez un message">
    <button onclick="sendMessage()">Envoyer</button>
  </div>
  <div id="waiting">
    <h2>Salle d’attente</h2>
    <p id="waitingList"></p>
  </div>

  <script>
    const socket = io('http://localhost:3000'); // Remplacer par URL Render plus tard

    socket.on('connect', () => {
      console.log('Connecté au serveur !');
    });

    socket.on('joinedChat', (data) => {
      document.getElementById('join').style.display = 'none';
      document.getElementById('chat').style.display = 'block';
      document.getElementById('waiting').style.display = 'none';
      addMessage(data.message);
    });

    socket.on('waitingUpdate', (list) => {
      document.getElementById('join').style.display = 'none';
      document.getElementById('chat').style.display = 'none';
      document.getElementById('waiting').style.display = 'block';
      document.getElementById('waitingList').textContent = list;
    });

    socket.on('userJoined', (message) => {
      addMessage(message);
    });

    socket.on('newMessage', (data) => {
      addMessage(`${data.username}: ${data.message}`);
    });

    function joinChat() {
      const username = document.getElementById('username').value || 'Utilisateur' + Math.floor(Math.random() * 100);
      socket.emit('join', username);
    }

    function sendMessage() {
      const msg = document.getElementById('messageInput').value;
      if (msg) {
        socket.emit('sendMessage', msg);
        document.getElementById('messageInput').value = '';
      }
    }

    function addMessage(message) {
      const messagesDiv = document.getElementById('messages');
      messagesDiv.innerHTML += `<p>${message}</p>`;
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
  </script>
</body>
</html>